<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biomedical Asset QR Scanner</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #eef2f5;
  margin: 0;
  padding: 15px;
}

/* LOGO */
.logo {
  text-align: center;
  margin-bottom: 10px;
}
.logo img {
  max-height: 80px;
}

/* HEADING */
h2 {
  text-align: center;
  color: #003366;
}

/* SCANNER */
#reader {
  width: 100%;
  max-width: 360px;
  margin: auto;
}

/* CARD */
.card {
  background: #ffffff;
  border-radius: 10px;
  padding: 15px;
  margin-top: 15px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

/* ROW GRID FOR ALIGNMENT */
.row {
  display: grid;
  grid-template-columns: 150px 10px auto; /* Label | Colon | Value */
  margin-bottom: 6px;
  align-items: center;
}

/* LABEL */
.label {
  font-weight: bold;
}

/* COLON */
.colon {
  text-align: center;
  font-weight: bold;
}

/* ANSWER */
.value {
  font-weight: normal;
  color: #000000;
  font-size: 14px;
}

/* FIELDSET */
fieldset {
  border-radius: 8px;
  padding: 10px;
  margin-top: 12px;
  border: 2px solid #007bff;
  background: #f4f9ff;
}

legend {
  padding: 0 8px;
  font-weight: bold;
  font-size: 14px;
  color: #007bff;
}

/* BUTTON */
.btn {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border: none;
  border-radius: 6px;
  background: #0066cc;
  color: white;
  font-size: 15px;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="logo">
  <img src="logo.jpg" alt="Company Logo">
</div>

<h2>Biomedical Asset QR Scanner</h2>

<div id="reader"></div>
<div id="assetCard" class="card" style="display:none;"></div>

<script src="https://unpkg.com/html5-qrcode"></script>

<script>
const SHEET_URL = "https://opensheet.elk.sh/1dULGqA1if8CIroCKIWznYAKujZB9bPr2lCBAhQZmOfY/Sheet2";
const assetCard = document.getElementById("assetCard");

function openPDF(url) {
  if (!url) {
    alert("PDF not available");
    return;
  }
  window.open(url, "_blank");
}

function showAsset(a) {
  assetCard.innerHTML = `
    <div class="row"><div class="label">Asset No</div><div class="colon">:</div><div class="value">${a.Asset_No}</div></div>
    <div class="row"><div class="label">Department</div><div class="colon">:</div><div class="value">${a.Department}</div></div>
    <div class="row"><div class="label">Equipment</div><div class="colon">:</div><div class="value">${a.Equipment}</div></div>
    <div class="row"><div class="label">Model</div><div class="colon">:</div><div class="value">${a.Model}</div></div>
    <div class="row"><div class="label">Make</div><div class="colon">:</div><div class="value">${a.Make}</div></div>
    <div class="row"><div class="label">Serial No</div><div class="colon">:</div><div class="value">${a.Serial_No}</div></div>
    <div class="row"><div class="label">Installation Date</div><div class="colon">:</div><div class="value">${a.Installation_Date || "—"}</div></div>

    <fieldset>
      <legend>PMS</legend>
      <div class="row"><div class="label">Done On</div><div class="colon">:</div><div class="value">${a.PMS_Done_On || "—"}</div></div>
      <div class="row"><div class="label">Due On</div><div class="colon">:</div><div class="value">${a.PMS_Due_On || "—"}</div></div>
    </fieldset>

    <fieldset>
      <legend>Calibration</legend>
      <div class="row"><div class="label">Done On</div><div class="colon">:</div><div class="value">${a.Calibration_Done_On || "—"}</div></div>
      <div class="row"><div class="label">Due On</div><div class="colon">:</div><div class="value">${a.Calibration_Due_On || "—"}</div></div>
    </fieldset>

    <hr>

    <button class="btn" onclick="openPDF('${a.Installation_PDF}')">Installation Report</button>
    <button class="btn" onclick="openPDF('${a.PMS_PDF}')">PMS Report</button>
    <button class="btn" onclick="openPDF('${a.Calibration_PDF}')">Calibration Report</button>
    <button class="btn" onclick="openPDF('${a.Breakdown_PDF}')">Breakdown Report</button>
  `;
  assetCard.style.display = "block";
}

/* BACK CAMERA ONLY */
const qr = new Html5Qrcode("reader");

Html5Qrcode.getCameras().then(cameras => {
  const backCam =
    cameras.find(c => c.label.toLowerCase().includes("back")) ||
    cameras[cameras.length - 1];

  qr.start(
    backCam.id,
    { fps: 15, qrbox: { width: 280, height: 280 } },
    qrText => {
      qr.stop();
      fetch(SHEET_URL)
        .then(res => res.json())
        .then(data => {
          const asset = data.find(a => a.Asset_No === qrText.trim());
          if (!asset) {
            alert("Asset not found");
            return;
          }
          showAsset(asset);
        });
    }
  );
});
</script>

</body>
</html>
