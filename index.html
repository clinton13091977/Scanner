<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biomedical QR Scanner</title>

<style>
body { font-family: Arial; background:#eef2f5; padding:15px; }
#reader { max-width:360px; margin:auto; }
.card { background:#fff; padding:15px; border-radius:8px; margin-top:15px; }
.row { margin-bottom:6px; }
.label { font-weight:bold; }
</style>
</head>

<body>

<h2 style="text-align:center">Biomedical Asset QR Scanner</h2>

<div id="reader"></div>
<div id="result" class="card" style="display:none;"></div>

<script src="https://unpkg.com/html5-qrcode"></script>

<script>
const SHEET_URL = "https://opensheet.elk.sh/1dULGqA1if8CIroCKIWznYAKujZB9bPr2lCBAhQZmOfY/Sheet1";
const result = document.getElementById("result");

const qr = new Html5Qrcode("reader");

qr.start(
  { facingMode: "environment" },
  { fps: 15, qrbox: 260 },
  qrText => {
    qr.stop();

    const assetNo = qrText.trim();
    console.log("Scanned:", assetNo);

    fetch(SHEET_URL)
      .then(res => res.json())
      .then(data => {
        const asset = data.find(a => a.Asset_No === assetNo);

        if (!asset) {
          alert("Asset NOT found in sheet");
          return;
        }

        result.innerHTML = `
          <div class="row"><span class="label">Asset No:</span> ${asset.Asset_No}</div>
          <div class="row"><span class="label">Equipment:</span> ${asset.Equipment}</div>
          <div class="row"><span class="label">Installation:</span> ${asset.Installation_Date}</div>
          <div class="row"><span class="label">PMS:</span> ${asset.PMS_Done_On}</div>
          <div class="row"><span class="label">Calibration:</span> ${asset.Calibration_Done_On}</div>

          <button onclick="window.open('${asset.Installation_PDF}')">Installation PDF</button>
          <button onclick="window.open('${asset.PMS_PDF}')">PMS PDF</button>
          <button onclick="window.open('${asset.Calibration_PDF}')">Calibration PDF</button>
        `;
        result.style.display = "block";
      })
      .catch(err => {
        alert("Sheet fetch failed");
        console.error(err);
      });
  }
);
</script>

</body>
</html>
