<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biomedical Asset QR Scanner</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #eef2f5;
    margin: 0;
    padding: 15px;
}
h2 {
    text-align: center;
    color: #003366;
}
#reader {
    width: 100%;
    max-width: 360px;
    margin: auto;
}
.card {
    background: #fff;
    border-radius: 10px;
    padding: 15px;
    margin-top: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}
.row {
    margin-bottom: 6px;
}
.label {
    font-weight: bold;
}
.btn {
    display: block;
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    border: none;
    border-radius: 6px;
    background: #0066cc;
    color: white;
    font-size: 15px;
}
</style>
</head>

<body>

<h2>Biomedical Asset QR Scanner</h2>

<div id="reader"></div>

<div id="assetCard" class="card" style="display:none;"></div>

<script src="https://unpkg.com/html5-qrcode"></script>

<script>
const assetCard = document.getElementById("assetCard");

/* ðŸ”¥ FORCE BACK CAMERA + FAST SCAN */
const qr = new Html5Qrcode("reader");

qr.start(
    { facingMode: "environment" },   // âœ… BACK CAMERA ONLY
    {
        fps: 30,
        qrbox: { width: 260, height: 260 },
        experimentalFeatures: {
            useBarCodeDetectorIfSupported: true
        }
    },
    (decodedText) => {
        qr.stop();
        loadAssetData(decodedText.trim());
    },
    () => {}
);

/* ðŸ”— FETCH DATA FROM GOOGLE SHEET / JSON */
function loadAssetData(url) {
    fetch(url)
        .then(res => res.json())
        .then(data => showAsset(data))
        .catch(() => {
            assetCard.style.display = "block";
            assetCard.innerHTML = "<b>Invalid or unreachable data</b>";
        });
}

/* ðŸ“‹ DISPLAY DATA */
function showAsset(d) {
    assetCard.style.display = "block";
    assetCard.innerHTML = `
        <div class="row"><span class="label">Asset No:</span> ${d.asset_no}</div>
        <div class="row"><span class="label">Department:</span> ${d.department}</div>
        <div class="row"><span class="label">Equipment:</span> ${d.equipment}</div>
        <div class="row"><span class="label">Model:</span> ${d.model}</div>
        <div class="row"><span class="label">Make:</span> ${d.make}</div>
        <div class="row"><span class="label">Serial No:</span> ${d.serial_no}</div>

        <button class="btn" onclick="openPDF('${d.installation_pdf}')">Installation PDF</button>
        <button class="btn" onclick="openPDF('${d.pms_pdf}')">PMS PDF</button>
        <button class="btn" onclick="openPDF('${d.calibration_pdf}')">Calibration PDF</button>
    `;
}

function openPDF(url) {
    window.open(url, "_blank");
}
</script>

</body>
</html>
