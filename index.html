<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JIMSH-NK Biomedical Asset QR Scanner</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    margin: 0;
    padding: 15px;
}

h2 {
    text-align: center;
    color: #003366;
}

#reader {
    width: 100%;
    max-width: 350px;
    margin: auto;
}

.card {
    background: #fff;
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.label {
    font-weight: bold;
    color: #444;
}

.value {
    margin-bottom: 8px;
}

a {
    display: block;
    margin: 6px 0;
    color: #0066cc;
    text-decoration: none;
    font-weight: bold;
}
</style>
</head>

<body>

<h2>JIMSH-NK Biomedical Asset QR Scanner</h2>

<div id="reader"></div>

<div id="result" class="card" style="display:none;"></div>

<!-- QR Scanner Library -->
<script src="https://unpkg.com/html5-qrcode"></script>

<script>
const resultDiv = document.getElementById("result");

function showData(data) {
    let html = `
        <div class="value"><span class="label">Asset No:</span> ${data.asset_no}</div>
        <div class="value"><span class="label">Department:</span> ${data.department}</div>
        <div class="value"><span class="label">Equipment:</span> ${data.equipment}</div>
        <div class="value"><span class="label">Model:</span> ${data.model}</div>
        <div class="value"><span class="label">Make:</span> ${data.make}</div>
        <div class="value"><span class="label">Serial No:</span> ${data.serial_no}</div>
        <div class="value"><span class="label">Installation Date:</span> ${data.installation_date}</div>
        <div class="value"><span class="label">PMS Done On:</span> ${data.pms_done_on}</div>
        <div class="value"><span class="label">Calibration Done On:</span> ${data.calibration_done_on}</div>

        <hr>

        <a href="${data.installation_pdf}" target="_blank">ðŸ“„ Installation Report</a>
        <a href="${data.pms_pdf}" target="_blank">ðŸ“„ PMS Report</a>
        <a href="${data.calibration_pdf}" target="_blank">ðŸ“„ Calibration Report</a>
        <a href="${data.breakdown_pdf}" target="_blank">ðŸ“„ Breakdown Report</a>
    `;

    resultDiv.innerHTML = html;
    resultDiv.style.display = "block";
}

// Start QR Scanner
const html5QrCode = new Html5Qrcode("reader");

Html5Qrcode.getCameras().then(cameras => {
    if (cameras && cameras.length) {

        // BACK CAMERA
        const backCamera = cameras.find(cam =>
            cam.label.toLowerCase().includes("back")
        ) || cameras[0];

        html5QrCode.start(
            backCamera.id,
            { fps: 10, qrbox: 250 },
            qrCodeMessage => {
                try {
                    const jsonData = JSON.parse(qrCodeMessage);
                    html5QrCode.stop();
                    showData(jsonData);
                } catch (e) {
                    alert("Invalid QR JSON format");
                }
            }
        );
    }
}).catch(err => {
    alert("Camera error: " + err);
});
</script>

</body>
</html>
