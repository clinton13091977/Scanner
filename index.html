<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Biomedical Asset QR Scanner</title>

<script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:15px;
}
h2{text-align:center;}
#reader{width:100%; max-width:360px; margin:auto;}
.card{
  background:#fff;
  padding:15px;
  margin-top:15px;
  border-radius:10px;
}
button{
  width:100%;
  padding:12px;
  margin-top:8px;
  background:#2563eb;
  color:#fff;
  border:none;
  border-radius:6px;
  font-size:16px;
}
</style>
</head>

<body>

<h2>Biomedical Asset QR Scanner</h2>

<button onclick="startScanner()">â–¶ START SCANNER</button>

<div id="reader"></div>

<div id="output" class="card" style="display:none;">
  <p><b>Asset No:</b> <span id="asset"></span></p>
  <p><b>Department:</b> <span id="dept"></span></p>
  <p><b>Equipment:</b> <span id="equip"></span></p>
  <p><b>Model:</b> <span id="model"></span></p>
  <p><b>Make:</b> <span id="make"></span></p>
  <p><b>Serial No:</b> <span id="serial"></span></p>
  <p><b>Installation Date:</b> <span id="inst"></span></p>
  <p><b>PMS Done On:</b> <span id="pms"></span></p>
  <p><b>Calibration Done On:</b> <span id="cal"></span></p>

  <button onclick="openPDF(instPDF)">Open Installation Report</button>
  <button onclick="openPDF(pmsPDF)">Open PMS Report</button>
  <button onclick="openPDF(calPDF)">Open Calibration Report</button>
  <button onclick="openPDF(bdPDF)">Open Breakdown Report</button>
</div>

<script>
let qr;
let instPDF="", pmsPDF="", calPDF="", bdPDF="";

function startScanner(){
  qr = new Html5Qrcode("reader");

  qr.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    onScanSuccess
  ).catch(err=>{
    alert("Camera error: " + err);
  });
}

function onScanSuccess(text){
  try{
    const data = JSON.parse(text);

    document.getElementById("asset").innerText = data["Asset Number"] || "";
    document.getElementById("dept").innerText = data["Department"] || "";
    document.getElementById("equip").innerText = data["Equipment"] || "";
    document.getElementById("model").innerText = data["Model"] || "";
    document.getElementById("make").innerText = data["Make"] || "";
    document.getElementById("serial").innerText = data["Serial Number"] || "";
    document.getElementById("inst").innerText = data["Installation Date"] || "";
    document.getElementById("pms").innerText = data["PMS Done On"] || "";
    document.getElementById("cal").innerText = data["Calibration Done On"] || "";

    instPDF = data["Installation_pdf"] || "";
    pmsPDF  = data["PMS_pdf"] || "";
    calPDF  = data["Calibration_pdf"] || "";
    bdPDF   = data["Last Breakdown_pdf"] || "";

    document.getElementById("output").style.display="block";
    qr.stop();

  }catch(e){
    alert("Invalid QR JSON");
  }
}

function openPDF(link){
  if(link) window.open(link,"_blank");
  else alert("PDF not available");
}
</script>

</body>
</html>
